\documentclass{book}
\usepackage{imakeidx}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage[gen]{eurosym}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{graphicx}
\usepackage{etoolbox}
\usepackage{titleps}
\usepackage{float}
% use hidelinks to remove boxes around links to be similar with Texinfo TeX
\usepackage[hidelinks]{hyperref}
\usepackage[utf8]{inputenc}

\newcommand{\GNUTexinfosettitle}{No Title}%

\makeindex[name=fn]%
\makeindex[name=vr]%

% redefine the \mainmatter command such that it does not clear page
% as if in double page
\makeatletter
\renewcommand\mainmatter{\clearpage\@mainmattertrue\pagenumbering{arabic}}
\makeatother
% add command aliases to use the same command in book and report
\newcommand\GNUTexinfomainmatter{\mainmatter}
\newcommand\GNUTexinfofrontmatter{\frontmatter}
% command that does nothing used to help with substitutions in commands
\newcommand{\GNUTexinfoplaceholder}[1]{}

% plain page style, for part and chapter, which call \thispagestyle{plain}
\renewpagestyle{plain}{\sethead[\thepage{}][][]
                             {}{}{\thepage{}}}

% single header
\newpagestyle{single}{\sethead[\chaptername{} \thechapter{} \chaptertitle{}][][\thepage]
                              {\chaptername{} \thechapter{} \chaptertitle{}}{}{\thepage}}

% called when setting single headers
\newcommand{\GNUTexinfosetsingleheader}{\pagestyle{single}}

% double header
\newpagestyle{double}{\sethead[\thepage{}][][\GNUTexinfosettitle]
                              {\chaptername{} \thechapter{} \chaptertitle{}}{}{\thepage}}

% called when setting double headers
\newcommand{\GNUTexinfosetdoubleheader}{\pagestyle{double}}


% avoid pagebreak and headings setting for a sectionning command
\newcommand{\GNUTexinfonopagebreakheading}[2]{\let\clearpage\relax \let\cleardoublepage\relax \let\thispagestyle\GNUTexinfoplaceholder #1{#2}}

\renewcommand{\includegraphics}[1]{\fbox{FIG \detokenize{#1}}}

% set default for @setchapternewpage
\makeatletter
\patchcmd{\chapter}{\if@openright\cleardoublepage\else\clearpage\fi}{\GNUTexinfoplaceholder{setchapternewpage placeholder}\clearpage}{}{}
\makeatother
\GNUTexinfosetsingleheader{}%


\begin{document}
\label{anchor:Top}%
\chapter{chapter}
\label{anchor:chapter}%

\noindent\texttt{int foobar \bgroup{}\normalfont{}\textsl{(int \textsl{foo}, float \textsl{bar})}\egroup{}}\hfill[Library Function]



\index[fn]{foobar@\texttt{foobar}}%
\dots{}\@

\noindent{}produces:
\noindent\texttt{border-pattern}\hfill[Class Option of \texttt{Window}]



\index[vr]{border-pattern@\texttt{border-pattern}}%
\dots{}\@

\begin{quote}
\noindent\texttt{int foobar \bgroup{}\normalfont{}\textsl{(int \textsl{foo}, float \textsl{bar})}\egroup{}}\hfill[Library Function]



\index[fn]{foobar@\texttt{foobar}}%
\dots{}\@
\end{quote}

\noindent\texttt{apply \bgroup{}\normalfont{}\textsl{function \&rest arguments}\egroup{}}\hfill[Function]



\index[fn]{apply@\texttt{apply}}%
\texttt{apply} calls \textsl{function} with \textsl{arguments}

\noindent\texttt{name \bgroup{}\normalfont{}\textsl{argument \texttt{int} \texttt{a{-}{-}b} \textsl{var1}, word \texttt{{-}{-}} (\texttt{type other}, \textsl{var2}  {[}\texttt{float} {[}\textsl{var4})}\egroup{}}\hfill[Category]



\index[fn]{name@\texttt{name}}%
In deffn

\end{document}
