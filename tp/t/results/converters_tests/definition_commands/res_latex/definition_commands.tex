\documentclass{book}
\usepackage{imakeidx}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage[gen]{eurosym}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{graphicx}
\usepackage{etoolbox}
\usepackage{embrac}
\usepackage{titleps}
\usepackage{float}
% use hidelinks to remove boxes around links to be similar with Texinfo TeX
\usepackage[hidelinks]{hyperref}
\usepackage[utf8]{inputenc}

\newcommand{\GNUTexinfosettitle}{No Title}%

\makeindex[name=fn]%
\makeindex[name=vr]%

% redefine the \mainmatter command such that it does not clear page
% as if in double page
\makeatletter
\renewcommand\mainmatter{\clearpage\@mainmattertrue\pagenumbering{arabic}}
\makeatother
% add command aliases to use the same command in book and report
\newcommand\GNUTexinfomainmatter{\mainmatter}
\newcommand\GNUTexinfofrontmatter{\frontmatter}
% command that does nothing used to help with substitutions in commands
\newcommand{\GNUTexinfoplaceholder}[1]{}

% plain page style, for part and chapter, which call \thispagestyle{plain}
\renewpagestyle{plain}{\sethead[\thepage{}][][]
                             {}{}{\thepage{}}}

% single header
\newpagestyle{single}{\sethead[\chaptername{} \thechapter{} \chaptertitle{}][][\thepage]
                              {\chaptername{} \thechapter{} \chaptertitle{}}{}{\thepage}}

% called when setting single headers
\newcommand{\GNUTexinfosetsingleheader}{\pagestyle{single}}

% double header
\newpagestyle{double}{\sethead[\thepage{}][][\GNUTexinfosettitle]
                              {\chaptername{} \thechapter{} \chaptertitle{}}{}{\thepage}}

% called when setting double headers
\newcommand{\GNUTexinfosetdoubleheader}{\pagestyle{double}}


% avoid pagebreak and headings setting for a sectionning command
\newcommand{\GNUTexinfonopagebreakheading}[2]{\let\clearpage\relax \let\cleardoublepage\relax \let\thispagestyle\GNUTexinfoplaceholder #1{#2}}

% braces are upright in italic and slanted only in @def*
% so it is turned off here, and turned on @def* lines
\EmbracOff{}%

\renewcommand{\includegraphics}[1]{\fbox{FIG \detokenize{#1}}}

% set default for @setchapternewpage
\makeatletter
\patchcmd{\chapter}{\if@openright\cleardoublepage\else\clearpage\fi}{\GNUTexinfoplaceholder{setchapternewpage placeholder}\clearpage}{}{}
\makeatother
\GNUTexinfosetsingleheader{}%


\begin{document}
\label{anchor:Top}%
\chapter{chapter}
\label{anchor:chapter}%

\noindent\texttt{fname \EmbracOn{}\textsl{a{-}{-}{-}rg1 a{-}{-}rg2}}\hfill[Func]



\index[fn]{fname@\texttt{fname}}%
deffn no var for \textsl{a---rg1} and \textsl{a--rg2}

\noindent\texttt{fname \EmbracOn{}\textsl{\EmbracOff{}\textsl{a{-}{-}{-}rg1}\EmbracOn{} \EmbracOff{}\textsl{a{-}{-}rg2}\EmbracOn{}}}\hfill[Func]



\index[fn]{fname@\texttt{fname}}%
deffn explict var for \textsl{a---rg1} and \textsl{a--rg2}

\noindent\texttt{fname \EmbracOn{}\textsl{\EmbracOff{}\textnormal{\textsl{a{-}{-}{-}rg1}}\EmbracOn{} \EmbracOff{}\textnormal{\textsl{a{-}{-}rg2}}\EmbracOn{}}}\hfill[Func]



\index[fn]{fname@\texttt{fname}}%
deffn r slanted for \textsl{a---rg1} and \textsl{a--rg2}

\noindent\texttt{foobar \EmbracOn{}\textsl{(var [from to [inc]]) body\dots{}\@}}\hfill[Special Form]



\index[fn]{foobar@\texttt{foobar}}%

\noindent\texttt{\texttt{.ft} \EmbracOn{}\textsl{[\EmbracOff{}\textnormal{\textsl{font}}\EmbracOn{}]}}\hfill[Request]



\index[fn]{.ft@\texttt{\texttt{.ft}}}%
\noindent\texttt{\texttt{\textbackslash{}f}\textnormal{\textsl{f}}\texttt{}}\hfill[Escape\hbox{}sequence]



\index[fn]{\textbackslash{}ff@\texttt{\texttt{\textbackslash{}f}\textnormal{\textsl{f}}\texttt{}}}%
\noindent\texttt{\texttt{\textbackslash{}f(}\textnormal{\textsl{fn}}\texttt{}}\hfill[Escape\hbox{}sequence]



\index[fn]{\textbackslash{}f(fn@\texttt{\texttt{\textbackslash{}f(}\textnormal{\textsl{fn}}\texttt{}}}%
\noindent\texttt{\texttt{\textbackslash{}f[}\textnormal{\textsl{font}}\texttt{]} \EmbracOn{}\textsl{\EmbracOff{}\texttt{\textbackslash{}f[}\EmbracOn{}\EmbracOff{}\textnormal{\textsl{font}}\EmbracOn{}\EmbracOff{}\texttt{]}\EmbracOn{}}}\hfill[Escape\hbox{}sequence]



\index[fn]{\textbackslash{}f[font]@\texttt{\texttt{\textbackslash{}f[}\textnormal{\textsl{font}}\texttt{]}}}%
\noindent\texttt{\texttt{\textbackslash{}n[.sty]}}\hfill[Register]



\index[fn]{\textbackslash{}n[.sty]@\texttt{\texttt{\textbackslash{}n[.sty]}}}%
The \texttt{ft} request and the \texttt{\textbackslash{}f} escape change the current font
to \textsl{font} (one-character name\hbox{}\textsl{f}, two-character name
\textsl{fn}).

\noindent\texttt{foobar \EmbracOn{}\textsl{[ \EmbracOff{}\textnormal{[}\EmbracOn{} \EmbracOff{}\textsl{[}\EmbracOn{} \EmbracOff{}\texttt{[}\EmbracOn{} \EmbracOff{}\texttt{[}\EmbracOn{} \EmbracOff{}\textnormal{\textsl{[}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{[}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{\textsl{[}}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{[}}\EmbracOn{} , \EmbracOff{}\textnormal{,}\EmbracOn{} \EmbracOff{}\textsl{,}\EmbracOn{} \EmbracOff{}\texttt{,}\EmbracOn{} \EmbracOff{}\texttt{,}\EmbracOn{} \EmbracOff{}\textnormal{\textsl{,}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{,}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{\textsl{,}}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{,}}\EmbracOn{} ] \EmbracOff{}\textnormal{]}\EmbracOn{} \EmbracOff{}\textsl{]}\EmbracOn{} \EmbracOff{}\texttt{]}\EmbracOn{} \EmbracOff{}\texttt{]}\EmbracOn{} \EmbracOff{}\textnormal{\textsl{]}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{]}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{\textsl{]}}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{]}}\EmbracOn{}}}\hfill[Special Form]



\index[fn]{foobar@\texttt{foobar}}%
\noindent\texttt{foobar \EmbracOn{}\textsl{[] \EmbracOff{}\textnormal{[]}\EmbracOn{} \EmbracOff{}\textsl{[]}\EmbracOn{} \EmbracOff{}\texttt{[]}\EmbracOn{} \EmbracOff{}\texttt{[]}\EmbracOn{} \EmbracOff{}\textnormal{\textsl{[]}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{[]}}\EmbracOn{} \EmbracOff{}\textnormal{\texttt{\textsl{[]}}}\EmbracOn{}}}\hfill[Special Form]



\index[fn]{foobar@\texttt{foobar}}%
test formatting of separators

\noindent\texttt{int foobar (int \textsl{f{-}{-}{-}oo}, float \textsl{b{-}{-}ar})}\hfill[Library Function]



\index[fn]{foobar@\texttt{foobar}}%
\dots{}\@ with var for \textsl{f---oo} and \textsl{b--ar}

\noindent\texttt{int foobar (int \textnormal{\textsl{f{-}{-}{-}oo}}, float \textnormal{\textsl{b{-}{-}ar}})}\hfill[Library Function]



\index[fn]{foobar@\texttt{foobar}}%
\dots{}\@ with r slanted for \textsl{f---oo} and \textsl{b--ar}

\noindent{}produces:
\noindent\texttt{border-pattern}\hfill[Class Option of \texttt{Window}]



\index[vr]{border-pattern@\texttt{border-pattern}}%
\dots{}\@

\noindent\texttt{\texttt{int} border-pattern}\hfill[Class Option of \texttt{Window}]



\index[vr]{border-pattern of Window@\texttt{border-pattern of Window}}%
\dots{}\@

\begin{quote}
\noindent\texttt{int foobar (int \textsl{foo}, float \textsl{bar})}\hfill[Library Function]



\index[fn]{foobar@\texttt{foobar}}%
\dots{}\@ for \textsl{foo} and \textsl{bar}
\end{quote}

\noindent\texttt{apply \EmbracOn{}\textsl{function \&rest arguments}}\hfill[Function]



\index[fn]{apply@\texttt{apply}}%
\texttt{apply} calls no var \textsl{function} with \textsl{arguments}

\noindent\texttt{apply \EmbracOn{}\textsl{function \EmbracOff{}\textnormal{\textbf{\&rest }}\EmbracOn{} argument}}\hfill[Function]



\index[fn]{apply@\texttt{apply}}%
explicit keyword marking, no var \textsl{function} with \textsl{arguments}

\noindent\texttt{name \EmbracOn{}\textsl{argument \EmbracOff{}\texttt{int}\EmbracOn{} \EmbracOff{}\texttt{a{-}{-}b}\EmbracOn{} \EmbracOff{}\textsl{v{-}{-}ar1}\EmbracOn{}, word \EmbracOff{}\texttt{{-}{-}}\EmbracOn{} (\EmbracOff{}\texttt{type o{-}{-}ther}\EmbracOn{}, \EmbracOff{}\textsl{v{-}{-}{-}ar2}\EmbracOn{}  [\EmbracOff{}\texttt{float}\EmbracOn{} [\EmbracOff{}\textsl{var4}\EmbracOn{}]])}}\hfill[Category]



\index[fn]{name@\texttt{name}}%
In deffn with code and var used

\end{document}
