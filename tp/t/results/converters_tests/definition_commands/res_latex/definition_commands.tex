\documentclass{book}
\usepackage{imakeidx}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage[gen]{eurosym}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{graphicx}
\usepackage{etoolbox}
\usepackage{titleps}
\usepackage{float}
% use hidelinks to remove boxes around links to be similar with Texinfo TeX
\usepackage[hidelinks]{hyperref}
\usepackage[utf8]{inputenc}

\newcommand{\GNUTexinfosettitle}{No Title}%

\makeindex[name=fn]%
\makeindex[name=vr]%

% redefine the \mainmatter command such that it does not clear page
% as if in double page
\makeatletter
\renewcommand\mainmatter{\clearpage\@mainmattertrue\pagenumbering{arabic}}
\makeatother
% add command aliases to use the same command in book and report
\newcommand\GNUTexinfomainmatter{\mainmatter}
\newcommand\GNUTexinfofrontmatter{\frontmatter}
% command that does nothing used to help with substitutions in commands
\newcommand{\GNUTexinfoplaceholder}[1]{}

% plain page style, for part and chapter, which call \thispagestyle{plain}
\renewpagestyle{plain}{\sethead[\thepage{}][][]
                             {}{}{\thepage{}}}

% single header
\newpagestyle{single}{\sethead[\chaptername{} \thechapter{} \chaptertitle{}][][\thepage]
                              {\chaptername{} \thechapter{} \chaptertitle{}}{}{\thepage}}

% called when setting single headers
\newcommand{\GNUTexinfosetsingleheader}{\pagestyle{single}}

% double header
\newpagestyle{double}{\sethead[\thepage{}][][\GNUTexinfosettitle]
                              {\chaptername{} \thechapter{} \chaptertitle{}}{}{\thepage}}

% called when setting double headers
\newcommand{\GNUTexinfosetdoubleheader}{\pagestyle{double}}


% avoid pagebreak and headings setting for a sectionning command
\newcommand{\GNUTexinfonopagebreakheading}[2]{\let\clearpage\relax \let\cleardoublepage\relax \let\thispagestyle\GNUTexinfoplaceholder #1{#2}}

\renewcommand{\includegraphics}[1]{\fbox{FIG \detokenize{#1}}}

% set default for @setchapternewpage
\makeatletter
\patchcmd{\chapter}{\if@openright\cleardoublepage\else\clearpage\fi}{\GNUTexinfoplaceholder{setchapternewpage placeholder}\clearpage}{}{}
\makeatother
\GNUTexinfosetsingleheader{}%


\begin{document}
\label{anchor:Top}%
\chapter{chapter}
\label{anchor:chapter}%

\noindent\texttt{fname \bgroup{}\normalfont{}\textsl{a---rg1 a--rg2}\egroup{}}\hfill[Func]



\index[fn]{fname@\texttt{fname}}%
deffn no var for \textsl{a---rg1} and \textsl{a--rg2}

\noindent\texttt{fname \bgroup{}\normalfont{}\textsl{\textsl{a---rg1} \textsl{a--rg2}}\egroup{}}\hfill[Func]



\index[fn]{fname@\texttt{fname}}%
deffn explict var for \textsl{a---rg1} and \textsl{a--rg2}

\noindent\texttt{fname \bgroup{}\normalfont{}\textsl{\textrm{\textsl{a---rg1}} \textrm{\textsl{a--rg2}}}\egroup{}}\hfill[Func]



\index[fn]{fname@\texttt{fname}}%
deffn r slanted for \textsl{a---rg1} and \textsl{a--rg2}

\noindent\texttt{foobar \bgroup{}\normalfont{}\textsl{(var {[}from to {[}inc{]}{]}) body\dots{}\@}\egroup{}}\hfill[Special Form]



\index[fn]{foobar@\texttt{foobar}}%

\noindent\texttt{int foobar \bgroup{}\normalfont{}\textsl{(int \textsl{f---oo}, float \textsl{b--ar})}\egroup{}}\hfill[Library Function]



\index[fn]{foobar@\texttt{foobar}}%
\dots{}\@ with var for \textsl{f---oo} and \textsl{b--ar}

\noindent\texttt{int foobar \bgroup{}\normalfont{}\textsl{(int \textrm{\textsl{f---oo}}, float \textrm{\textsl{b--ar}})}\egroup{}}\hfill[Library Function]



\index[fn]{foobar@\texttt{foobar}}%
\dots{}\@ with r slanted for \textsl{f---oo} and \textsl{b--ar}

\noindent{}produces:
\noindent\texttt{border-pattern}\hfill[Class Option of \texttt{Window}]



\index[vr]{border-pattern@\texttt{border-pattern}}%
\dots{}\@

\noindent\texttt{\texttt{int} border-pattern}\hfill[Class Option of \texttt{Window}]



\index[vr]{border-pattern of Window@\texttt{border-pattern of Window}}%
\dots{}\@

\begin{quote}
\noindent\texttt{int foobar \bgroup{}\normalfont{}\textsl{(int \textsl{foo}, float \textsl{bar})}\egroup{}}\hfill[Library Function]



\index[fn]{foobar@\texttt{foobar}}%
\dots{}\@ for \textsl{foo} and \textsl{bar}
\end{quote}

\noindent\texttt{apply \bgroup{}\normalfont{}\textsl{function \&rest arguments}\egroup{}}\hfill[Function]



\index[fn]{apply@\texttt{apply}}%
\texttt{apply} calls no var \textsl{function} with \textsl{arguments}

\noindent\texttt{apply \bgroup{}\normalfont{}\textsl{function \textrm{\textbf{\&rest}} argument}\egroup{}}\hfill[Function]



\index[fn]{apply@\texttt{apply}}%
explicit keyword marking, no var \textsl{function} with \textsl{arguments}

\noindent\texttt{name \bgroup{}\normalfont{}\textsl{argument \texttt{int} \texttt{a{-}{-}b} \textsl{v--ar1}, word \texttt{{-}{-}} (\texttt{type o{-}{-}ther}, \textsl{v---ar2}  {[}\texttt{float} {[}\textsl{var4})}\egroup{}}\hfill[Category]



\index[fn]{name@\texttt{name}}%
In deffn with code and var used

\end{document}
